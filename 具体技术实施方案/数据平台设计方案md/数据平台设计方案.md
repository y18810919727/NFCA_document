# 数据平台设计

本数据平台负责整个软件平台数据的存储、读写、检索，日志记录等

## 参考资料

> 东南矿体充填站现场调研——充填站自控图纸和仪器(王洪江) ：
> http://202.204.62.195:8000/#group/3/lib/ba891f46-c957-4d4d-8328-da7d9bf8e721/%E4%B8%9C%E5%8D%97%E7%9F%BF%E4%BD%93%E5%85%85%E5%A1%AB%E7%AB%99%E7%8E%B0%E5%9C%BA%E8%B0%83%E7%A0%94/%E5%85%85%E5%A1%AB%E7%AB%99%E8%87%AA%E6%8E%A7%E5%9B%BE%E7%BA%B8%E5%92%8C%E4%BB%AA%E5%99%A8(%E7%8E%8B%E6%B4%AA%E6%B1%9F)

> 膏体充填实时控制决策支持系统（仿真）:
> https://x2e70c.axshare.com/#p=%E7%9B%91%E6%B5%8B%E6%8E%A7%E5%88%B6&g=1

## 数据存储

### 实时监测的数据

| 名称     | 数据类型 | 示例     |
| --------- | -------- | -------- |
| 记录数 | Integer | 1 |
| 工作模式       | String   | 排尾模式 |
| 输送情况       | String   | 正常     |
| 灰沙比         | Double   | 1.5      |
| 充填浓度       | Double   | 0.63     |
| 底流浓度       | Double   | 0.615    |
| 满管率         | Double   | 0.98     |
| 空气柱         | Double   | 0.25(m)  |
| 充填百分比     | Double   | 20(%)    |
| 进料浓度       | Double   | 5.0(%) |
| 进料流量 | Double | 10.0(%) |
| 浓密机底流浓度 | Double   | 7.5(%) |
| 充填浓度 | Double | 7.5(%) |
| 充填流量 | Double | 10.0(%) |
| 水泥流量 | Double | 10.0(%) |
| 时间戳 | Timestamp | 1557480710 |

### 仪器设备

> 注：所有仪器仪表类型、编号来自于PCD图纸

![](.\数据平台设计方案.assets\PCD图纸-仪器仪表.png)

| 名称         | 数据类型  | 示例              |
| ------------ | --------- | ----------------- |
| 记录数       | Integer   | 1                 |
| 仪器类型     | String    | 流量计            |
| 仪器编号     | String    | FI-210AG01        |
| 仪器工作模式 | Boolean   | true/false(开/关) |
| 仪器读数     | Double    | 0.12              |
| 时间戳       | Timestamp | 1557480710        |

### 控制日志

根据需求，建立控制日志表，以实时记录仪器仪表的工作模式转变。

| 名称               | 数据类型  | 示例              |
| ------------------ | --------- | ----------------- |
| 记录数             | Integer   | 1                 |
| 仪器编号           | String    | FI-210AG01        |
| 仪器转变前工作模式 | Boolean   | true/false(开/关) |
| 仪器转变后工作模式 | Boolean   | true/false(开/关) |
| 时间戳             | Timestamp | 1557480710        |

### 视频流数据

为方便进行搅拌均匀度判断，需要将采集得到的视频图像数据，定帧保存。

| 名称         | 数据类型  | 示例                    |
| ------------ | --------- | ----------------------- |
| 记录数       | Integer   | 1                       |
| 图像文件路径 | String    | ./figure/1557480710.jpg |
| 均匀度       | Double    | 90(%)                   |
| 时间戳       | Timestamp | 1557480710              |

### 报警日志

若监测到某仪器的值不在正常范围之内，则需要记录进报警日志，并提醒工作人员处理。

| 名称           | 数据类型  | 示例       |
| -------------- | --------- | ---------- |
| 记录数         | Integer   | 1          |
| 报警仪器编号   | String    | FI-210AG01 |
| 充填负责人     | String    | admin001   |
| 正常工作最小值 | Double    | 10.0       |
| 正常工作最大值 | Double    | 60.0       |
| 监测报警值     | Double    | 80.0       |
| 时间戳         | Timestamp | 1557480710 |

### 控制算法模型文件

用于加载深度学习模型。

| 名称           | 数据类型  | 示例            |
| -------------- | --------- | --------------- |
| 记录数         | Integer   | 1               |
| 模型           | String    | LSTM            |
| 模型文件位置   | String    | ./model/001.pth |

### 采场模型文件

用于加载采场模型。

| 名称         | 数据类型 | 示例            |
| ------------ | -------- | --------------- |
| 记录数       | Integer  | 1               |
| 模型         | String   | LSTM            |
| 模型文件位置 | String   | ./model/002.pth |

### 采场管理

| 名称       | 数据类型  | 示例                                    |
| ---------- | --------- | --------------------------------------- |
| 记录数     | Integer   | 1                                       |
| 采场编号   | Integer   | 001                                     |
| 充填百分比 | Double    | 100.0(%)                                |
| 创建时间   | Date      | Fri May 10 2019 20:39:57 GMT+0800 (CST) |
| 结束时间   | Date      | Fri May 12 2019 22:50:02 GMT+0800 (CST) |
| 任务状态   | Boolean   | true/false(完成/未完成)                 |
| 时间戳     | Timestamp | 1557480710                              |

### 系统日志文件

用于记录系统的一切变化，包括输入输出、数据库变化、错误信息等等。

### 一个键值型数据表用来存储各种配置参量

本系统由多个不同功能的子系统、软硬件组成，通过一个数据表来存储各种配置参量，方便查看目前系统运行状态。

### 管道安全管理（判断是否泄露/堵管）

| 名称       | 数据类型  | 示例                                    |
| ---------- | --------- | --------------------------------------- |
| 记录数     | Integer   | 1                                       |
| 采场编号   | Integer   | 001                                     |
| 充填百分比 | Double    | 100.0(%)                                |
| 创建时间   | Date      | Fri May 10 2019 20:39:57 GMT+0800 (CST) |
| 结束时间   | Date      | Fri May 12 2019 22:50:02 GMT+0800 (CST) |
| 任务状态   | Boolean   | true/false(完成/未完成)                 |
| 时间戳     | Timestamp | 1557480710                              |

## 数据检索

要求数据库支持检索数据，具体可分为：

1. 按时间检索
2. 按仪器编号检索
3. 按仪器类型检索
4. 按采场检索

## 定期清理+备份

由于数据库存储大小有限，并且要保证IO速度，因此有必要定期对数据库进行多重备份，并在备份完成后，定期清理时间久远的数据。